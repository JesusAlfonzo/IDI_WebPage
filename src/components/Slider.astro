---
---
<section
  id="slider"
  class="relative w-full max-w-screen-lg mx-auto overflow-hidden rounded-lg animate-blurred-fade-in aspect-video"
>
  <div class="flex h-full w-full transition-transform duration-500 ease-in-out">
    <figure class="flex-shrink-0 w-full h-full relative" data-active>
      <img
        src="../../public/images/IDI-slider-1.jpg"
        alt="IDI slider 1"
        class="w-full h-full block object-cover"
      />
      <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
    </figure>

    <figure class="flex-shrink-0 w-full h-full relative">
      <img
        src="../../public/images/IDI-slider-2.jpg"
        alt="IDI slider 2"
        class="w-full h-full block object-cover"
      />
      <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
    </figure>
  </div>

  <button
    class="absolute top-1/2 left-4 -translate-y-1/2 p-2 bg-white/20 hover:bg-white/40 rounded-full transition-colors duration-300 backdrop-blur-sm focus:outline-none"
    data-button="prev"
  >
    <svg
      class="w-8 h-8 text-white"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M15 19l-7-7 7-7"
      ></path>
    </svg>
  </button>

  <button
    class="absolute top-1/2 right-4 -translate-y-1/2 p-2 bg-white/20 hover:bg-white/40 rounded-full transition-colors duration-300 backdrop-blur-sm focus:outline-none"
    data-button="next"
  >
    <svg
      class="w-8 h-8 text-white"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M9 5l7 7-7 7"
      ></path>
    </svg>
  </button>
</section>

<script is:inline>
  /**
   * Función que inicializa toda la lógica del carrusel.
   * Se debe llamar cada vez que el DOM se actualiza.
   */
  function initSlider() {
    // 1. Las selecciones de DOM deben estar DENTRO de la función
    //    para que apunten a los elementos NUEVOS después del swap.
    const slider = document.querySelector("#slider");
    const sliderContainer = slider?.querySelector("div");
    
    // Si no encuentra el carrusel (ej: estás en otra página), sal de la función.
    if (!slider || !sliderContainer) return; 

    const childsSlider = [...slider.querySelectorAll("figure")];
    const nextButton = document.querySelector("[data-button='next']");
    const prevButton = document.querySelector("[data-button='prev']");
    const lengthImages = childsSlider.length;
    let currentIndex = 0;

    const updateSlider = () => {
      const offset = currentIndex * 100;
      sliderContainer.style.transform = `translateX(-${offset}%)`;
    };
    
    // **Importante:** Limpia cualquier listener anterior si es necesario.
    // En este caso, como los botones se reemplazan, no es estrictamente necesario,
    // pero es buena práctica si el script se ejecuta más de una vez sin un DOM nuevo.

    // 2. Asignación de eventos a los nuevos botones
    nextButton?.addEventListener("click", function (e) {
      currentIndex++;
      if (currentIndex >= lengthImages) {
        currentIndex = 0;
      }
      updateSlider();
    });

    prevButton?.addEventListener("click", function (e) {
      currentIndex--;
      if (currentIndex < 0) {
        currentIndex = lengthImages - 1;
      }
      updateSlider();
    });
  }

  // Ejecutar en la carga inicial
  initSlider();

  // Ejecutar después de cada navegación/swap (incluyendo saltos de ancla con View Transitions)
  document.addEventListener('astro:after-swap', initSlider);
</script>