<header class="animate-fade-in fixed top-0 w-full z-50">
  <nav
    class="grid grid-cols-2 md:grid-cols-[1fr_auto_1fr] border-b-1 border-gray-300 shadow-lg h-20 items-center px-4 bg-white/70 backdrop-blur-sm animate-fade-in"
  >
    <div class="flex justify-start">
      <a
        class="group relative text-indigo-600 hover:text-indigo-600 transition-colors duration-300 font-semibold"
        href="/"
      > 
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-600 group-hover:text-indigo-600 transition-colors duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 3H4a2 2 0 00-2 2v14a2 2 0 002 2h16a2 2 0 002-2V5a2 2 0 00-2-2h-5" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 3v4a2 2 0 002 2h2a2 2 0 002-2V3m-6 9v2a2 2 0 002 2h2a2 2 0 002-2v-2" />
        </svg>
        <span class="absolute left-0 -bottom-1 h-0.5 w-0 bg-indigo-600 transition-all duration-300 group-hover:w-full"></span>
      </a>
    </div>

    <button
      class="menu-toggle md:hidden justify-self-end text-gray-700 hover:text-indigo-600 transition-colors duration-300"
      aria-controls="mobile-menu"
      aria-expanded="false"
    >
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
      </svg>
    </button>

    <ul class="hidden navbar-menu md:flex gap-12 justify-center text-center font-semibold col-span-2 md:col-auto md:static p-4 md:p-0 flex-col md:flex-row">
      <li class="animate-blurred-fade-in"><a class="group relative hover:text-indigo-600 transition-colors duration-300 flex items-center space-x-1" href="/#servicios">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2m-9 0V3h4v2m-4 0h4" /></svg>
        <span>Servicios</span><span class="absolute left-0 -bottom-1 h-0.5 w-0 bg-indigo-600 transition-all duration-300 group-hover:w-full"></span>
      </a></li>
      <li class="animate-blurred-fade-in"><a class="group relative hover:text-indigo-600 transition-colors duration-300 flex items-center space-x-1" href="/examenes">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
        <span>Examenes</span><span class="absolute left-0 -bottom-1 h-0.5 w-0 bg-indigo-600 transition-all duration-300 group-hover:w-full"></span>
      </a></li>
      <li class="animate-blurred-fade-in"><a class="group relative hover:text-indigo-600 transition-colors duration-300 flex items-center space-x-1" href="/#ubicacion">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.828 0l-4.243-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
        <span>Ubicacion</span><span class="absolute left-0 -bottom-1 h-0.5 w-0 bg-indigo-600 transition-all duration-300 group-hover:w-full"></span>
      </a></li>
      <li class="animate-blurred-fade-in"><a class="group relative hover:text-indigo-600 transition-colors duration-300 flex items-center space-x-1" href="/#contacto">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>
        <span>Contacto</span><span class="absolute left-0 -bottom-1 h-0.5 w-0 bg-indigo-600 transition-all duration-300 group-hover:w-full"></span>
      </a></li>
    </ul>

    <div class="hidden md:flex justify-end">
        <a href="https://www.instagram.com/idiucv1989/?hl=es" target="_blank" rel="noopener noreferrer" class="text-gray-600 hover:text-blue-400 transition-colors duration-300 flex items-center space-x-2" aria-label="Instagram">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                <path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37z"></path>
                <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
            </svg>
        </a>
    </div>
  </nav>

  <div 
    id="mobile-menu-overlay" 
    class="fixed inset-0 bg-black/50 z-[999] hidden transition-opacity duration-300"
    aria-hidden="true"
  ></div>

  <div 
    id="mobile-menu" 
    class="fixed top-0 right-0 h-full w-64 bg-white shadow-2xl z-[1000] transform translate-x-full transition-transform duration-300"
    role="dialog"
    aria-modal="true"
  >
    <div class="p-6 flex flex-col h-full">
      <button 
        class="menu-toggle-close self-end text-gray-700 hover:text-indigo-600 transition-colors duration-300 mb-8"
        aria-label="Cerrar menú"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>

      <ul class="flex flex-col gap-6 text-xl font-semibold">
        <li><a class="hover:text-indigo-600" href="/#servicios">Servicios</a></li>
        <li><a class="hover:text-indigo-600" href="/examenes">Examenes</a></li>
        <li><a class="hover:text-indigo-600" href="/#ubicacion">Ubicacion</a></li>
        <li><a class="hover:text-indigo-600" href="/#contacto">Contacto</a></li>
      </ul>
      
      <div class="mt-auto pt-6 border-t border-gray-200">
        <a class="text-sm text-gray-500 hover:text-indigo-600" href="/">Redes Sociales</a>
      </div>
    </div>
  </div>
</header>
<script is:inline>
  // Definimos la función toggleMenu para que sea accesible.
  function toggleMenu(isOpen) {
    const menu = document.getElementById('mobile-menu');
    const overlay = document.getElementById('mobile-menu-overlay');
    
    if (!menu || !overlay) return; 

    if (isOpen) {
      overlay.classList.remove('hidden');
      document.body.classList.add('overflow-hidden');
      menu.classList.remove('translate-x-full'); 
      menu.classList.add('translate-x-0');
    } else {
      document.body.classList.remove('overflow-hidden');
      menu.classList.remove('translate-x-0');
      menu.classList.add('translate-x-full');
      
      setTimeout(() => {
        overlay.classList.add('hidden');
      }, 300); 
    }
  }

  // Comprobamos si el listener ya existe en la ventana/documento para evitar la duplicación.
  // Esto es crucial cuando el componente Nav se inyecta en múltiples páginas.
  if (!window.menuGlobalListenerAttached) {
    
    // Asignamos un listener único al documento entero.
    document.addEventListener('click', (e) => {
      const target = e.target;
      
      // 1. Botón Hamburguesa (para abrir)
      if (target.closest('.menu-toggle')) {
        e.preventDefault(); 
        toggleMenu(true);
        return;
      }
      
      // 2. Botones de cerrar (X) y Overlay
      if (target.closest('.menu-toggle-close') || target.id === 'mobile-menu-overlay') {
        toggleMenu(false);
        return;
      }
      
      // 3. Clic en cualquier enlace dentro del menú (para cerrar después de navegar)
      if (target.closest('#mobile-menu a')) {
          // El timeout es importante para que la navegación con View Transitions se registre
          setTimeout(() => toggleMenu(false), 50); 
      }
    });

    // Marcamos una variable global para asegurar que este bloque solo se ejecuta una vez.
    window.menuGlobalListenerAttached = true;
  }
  
  // Nota: Ya no necesitamos astro:page-load ni astro:after-swap, 
  // ya que el listener es permanente.
</script>